<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fabric.js/3.4.0/fabric.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jscolor/2.5.1/jscolor.min.js"></script>
    <script type="text/javascript" src="./vertex.js"></script>
    <script type="text/javascript" src="./create.js"></script>
    <script type="text/javascript" src="./fabric.js"></script>
    <script type="text/javascript" src="./move.js"></script>
    <script type="text/javascript" src="./link.js"></script>
    <script type="text/javascript" src="./delete.js"></script>
    <script type="text/javascript" src="./download.js"></script>
    <script type="text/javascript" src="./edge.js"></script>


    <style>
        canvas {
            border: 1px solid #ccc;
        }
    </style>
</head>

<body>
    <input class="switch" name="VertexOn" type="radio" id="create" /> <b>Create</b>
    <input class="switch" name="VertexOn" type="radio" id="link" /> <b>Link</b>
    <input class="switch" name="VertexOn" type="radio" id="delete" /> <b>Delete</b> <br>
    <input id="colorPicker" class="jscolor {onFineChange:'updateColor()'}"></input><br>
    <button id="directChange">direct/undirect edges</button><br>

    <canvas id="c" width="600" height="300"></canvas> <br>

    <button id="download">导出</button>
</body>

<script>
    var canvas = new fabric.Canvas('c');    // the object of canvas
    var VertexColor = '#ffffff';            // the color of vertexs
    var VertexRadius = 16;                  // the radius of vertexs
    var padding = 10;                       // the padding to prevent objects to reach the edge of the canvas
    var startVertex = null;                 // when linking two vertexs, record the first one
    var VertexArr = [];                     // the vertex array, recording what indexs are used
    var isDirect = 1;                       // if true, edges have arrows, representing direct edges 

    // the default format of a vertex
    var defaultVertex = {
        radius: VertexRadius,
        originX: 'center',
        originY: 'center',
        stroke: 'black',
        hasControls: false,
    };

    // the default format of related context on the vertex
    var defaultContext = {
        fontSize: 15,
        originX: 'center',
        originY: 'center',
        textAlign: 'center',
        fontWeight: 'bold',
    }

    // the default format of an edge
    var defaultLine = {
        strokeWidth: 2,
        fill: '#000000',
        stroke: '#000000',
        originX: 'center',
        originY: 'center',
        selectable: false,
        hasControls: false,
        hasBorders: false,
        evented: false,
        targetFindTolerance: true,
    };

    document.getElementById("create").checked = true;
    $('#colorPicker').val("#ffffff");
    jscolor.install();

    edgeInit();
    fabricInit();
    createInit();
    moveInit();
    linkInit();
    deleteInit();
    downloadInit();

    // set color for vertexs or edges
    function updateColor() {
        if (document.getElementById("create").checked) {
            VertexColor = $('#colorPicker').val();
        }

        if (document.getElementById("link").checked) {
            defaultLine.stroke = $('#colorPicker').val();
        }
    }

    // change whether edges have arrows
    $("#directChange").click(function () {
        isDirect = 1 - isDirect;
        canvas.renderAll();
    });

</script>

</html>